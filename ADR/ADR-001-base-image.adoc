= ADR-001: Docker Containerization on Pi Zero W

== Status

Accepted (Updated 2026-02-06: Switch to python:3.13-slim)

== Context

Deploy Flask app to Pi Zero W (ARMv6). Handle Python dependencies (Pillow, pyserial, Flask). Need Python ≥3.10 for MCP server integration.

*Deployment options:*
* Docker containerization
* Bare Python + pip
* Virtual environment + systemd
* .deb package

*Base image options:*
* Alpine Linux
* Official Raspberry Pi images
* Balena IoT images
* Official Python images
* Debian slim
* Ubuntu

== Decision

Docker with `python:3.13-slim` base (Debian trixie).

== Rationale

=== Why Docker?

*Recipe-based:* Dockerfile = executable docs. No hidden steps.

*Migration:* Container runs anywhere. Move to new Pi = copy container. Move to x86 = rebuild from same Dockerfile.

*Isolation:* System deps (libjpeg, libxcb) in container. No system pollution. Clean uninstall = remove container.

*Reproducibility:* Same Dockerfile → same environment. Every build identical.

*Version control:* Infrastructure as code. Changes tracked.

Rejected bare Python: Manual docs. Migration = rewrite.

Rejected .deb: Hardest to maintain. Cross-compilation. Overkill.

=== Why python:3.13-slim?

*ARMv6 support:* Official Python images now support ARMv6 (arm/v5 compatible). Tested on Pi Zero W.

*Python 3.13:* Matches Pi host version (Raspbian trixie). Enables MCP server (requires ≥3.10).

*Size:* 133MB base vs 250MB final (smaller than previous balenalib 376MB).

*Official:* Maintained by Docker Inc. Better long-term support than IoT-specific images.

*Debian trixie:* Latest stable. Modern package versions.

*No custom Python build:* Pre-installed Python 3.13. No compilation overhead.

*Package availability:* Updated Debian packages (libtiff6, libopenblas0-pthread).

=== Previous: balenalib (Deprecated)

Previously used `balenalib/raspberry-pi:bullseye` for ARMv6 support, but:

* Debian 11 (bullseye) = Python 3.9 (too old for MCP)
* 376MB final image (vs 250MB with python:3.13-slim)
* IoT-specific tweaks unnecessary for stationary Pi
* Official Python images now support ARMv6

== Consequences

.*Positive*
* Deployment = recipe, not procedure
* Migration trivial
* Dependencies isolated
* Build reproducible
* **Smaller image** (250MB vs 376MB)
* **Python 3.13** (MCP compatible)
* **Official image** (better support)
* **Matches Pi host** (both trixie)

.*Negative*
* Docker adds complexity
* Slightly slower startup
* More disk space
* Package name changes (trixie vs bullseye)

*Trade-offs accepted:* Modern Python + smaller size + MCP support outweigh package name migration.
