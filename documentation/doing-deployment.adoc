= Deployment Guide
ifdef::flag-book[]
:imagesdir-saved: {imagesdir}
:localdir-saved: {localdir}
:imagesdir: ./images
:localdir: ./documentation
endif::flag-book[]
ifndef::flag-book[]
:toc: right
:toclevels: 5
:sectnums:
:sectnumlevels: 5
ifdef::github-env[]
:icons: font
:tip-caption: :bulb:
:note-caption: :information_source:
:important-caption: :heavy_exclamation_mark:
:caution-caption: :fire:
:warning-caption: :warning:
endif::github-env[]
:imagesdir: ../images
:localdir: .
endif::flag-book[]

== Quick Start on Pi Zero W

=== Prerequisites
* Raspberry Pi Zero W with Raspberry Pi OS (Bullseye or later)
* Wainlux K6 connected via USB (CP2102 serial adapter)
* At least 1GB swap configured for Docker build
* Internet connection for initial setup

=== Install Docker

[source,bash]
----
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh
sudo usermod -aG docker $USER
# Log out and back in for group to take effect
----

=== Configure Swap

Check current swap:
[source,bash]
----
free -h
----

If less than 1GB, increase:
[source,bash]
----
sudo dphys-swapfile swapoff
sudo nano /etc/dphys-swapfile
# Set CONF_SWAPSIZE=1024
sudo dphys-swapfile setup
sudo dphys-swapfile swapon
----

=== Clone and Deploy

[source,bash]
----
cd ~/
git clone https://github.com/YOUR_USERNAME/wainlux-pi.git
cd wainlux-pi/docker-wainlux

# Build (takes 15-20 minutes on Pi Zero W)
docker compose build

# Start service
docker compose up -d

# Check logs
docker compose logs -f
----

=== Access Web Interface

Open browser to: `http://<pi-ip>:8080`

=== Test Connection

. Click `CONNECT` - should see `CONNECTED` status
. Click `HOME` - laser should home to origin
. Click `DRAW BOUNDS` - laser should trace 80x80mm rectangle (very light, depth=5)

=== Stopping Service

[source,bash]
----
cd ~/wainlux-pi/docker-wainlux
docker compose down
----

== Troubleshooting

=== Serial Device Not Found

[source,bash]
----
# Check if device is connected
lsusb | grep CP210

# Check device permissions
ls -l /dev/ttyUSB0

# Check if device is present
dmesg | grep ttyUSB
----

=== Build Fails (Out of Memory)

* Increase swap to 1GB minimum
* Ensure no other services consuming memory
* Consider building on faster machine and copying image

=== Container Won't Start

[source,bash]
----
# Check logs
docker compose logs

# Check if port 8080 is in use
sudo netstat -tulpn | grep 8080
----

=== Laser Doesn't Respond

. Check connection status in web UI
. Try disconnecting and reconnecting
. Power cycle the laser
. Check CSV logs in `docker-wainlux/data/` directory

== Data Directory

Logs are saved to `docker-wainlux/data/`:

* `burn-YYYYMMDDHHMMSS.csv` - Detailed burn logs
* Logs persist across container restarts

== Updating

[source,bash]
----
cd ~/wainlux-pi
git pull
cd docker-wainlux
docker compose down
docker compose build
docker compose up -d
----

== System Integration (Optional)

=== Run on Boot

Create systemd service:
[source,bash]
----
sudo nano /etc/systemd/system/wainlux-k6.service
----

Content:
[source,ini]
----
[Unit]
Description=Wainlux K6 Web Interface
Requires=docker.service
After=docker.service

[Service]
Type=oneshot
RemainAfterExit=yes
WorkingDirectory=/home/pi/wainlux-pi/docker-wainlux
ExecStart=/usr/bin/docker compose up -d
ExecStop=/usr/bin/docker compose down
User=pi

[Install]
WantedBy=multi-user.target
----

Enable:
[source,bash]
----
sudo systemctl enable wainlux-k6
sudo systemctl start wainlux-k6
----

== Hardware Notes

* *Power:* Pi Zero W draws ~200mA; use quality 5V 2A supply
* *UPS:* Optional UPS Lite v3 provides battery backup and safe shutdown
* *Camera:* Optional Pi Camera for burn preview (see documentation)
* *Case:* 3D printable case design in project repository

== Safety Reminders

[WARNING]
====
* Always wear laser safety glasses
* Never leave laser unattended
* Keep fire extinguisher/blanket nearby
* Use on fire-safe surface
* Install smoke detector in room
====

ifdef::flag-book[]
:imagesdir: {imagesdir-saved}
:localdir: {localdir-saved}
endif::flag-book[]
